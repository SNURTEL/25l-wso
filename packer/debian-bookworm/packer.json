{
  "builders": [
    {
      "accelerator": "kvm",
      "boot_command": [
        "<esc><wait>",
        "install ",
        "auto=true ",
        "priority=critical ",
        "preseed/url=http://{{ .HTTPIP }}:{{ .HTTPPort }}/preseed.cfg ",
        "debian-installer=en_US.UTF-8 ",
        "locale=en_US.UTF-8 ",
        "kbd-chooser/method=us ",
        "netcfg/get_hostname=debian ",
        "netcfg/get_domain=localdomain ",
        "fb=false ",
        "debconf/frontend=noninteractive ",
        "console-setup/ask_detect=false ",
        "console-keymaps-at/keymap=us ",
        "keyboard-configuration/xkb-keymap=us ",
        "<enter><wait>"
      ],
      "boot_wait": "15s",
      "disk_size": "4000M",
      "format": "qcow2",
      "headless": true,
      "http_directory": "http",
      "iso_checksum": "{{user `debian_iso_checksum`}}",
      "iso_url": "{{user `debian_iso_url`}}",
      "output_directory": "{{user `qemu_output_dir`}}",
      "host_port_max": 2229,
      "host_port_min": 2222,
      "ssh_password": "debian",
      "ssh_timeout": "45m",
      "ssh_username": "debian",
      "ssh_wait_timeout": "45m",
      "ssh_handshake_attempts": 10,
      "ssh_pty": true,
      "type": "qemu",
      "vm_name": "{{user `qemu_output_name`}}",
      "memory": 2048,
      "cpus": 2,
      "net_device": "virtio-net",
      "disk_interface": "virtio"

    }
  ],
  "provisioners": [
    {
      "inline": [
        "sudo apt update && sudo apt install nginx -y && sudo systemctl enable serial-getty@ttyS0.service && sudo systemctl start serial-getty@ttyS0.service"
      ],
      "type": "shell"
    }
  ],
  "variables": {
    "debian_iso_checksum": "sha256:30ca12a15cae6a1033e03ad59eb7f66a6d5a258dcf27acd115c2bd42d22640e8",
    "debian_iso_url": "https://cdimage.debian.org/debian-cd/current/amd64/iso-cd/debian-12.11.0-amd64-netinst.iso",
    "qemu_output_dir": "qemu-images",
    "qemu_output_name": "debian.qcow2"
  }
}
